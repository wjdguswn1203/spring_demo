<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>íšŒì›ê°€ì… Â· FortuneCookie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/fortune.css" rel="stylesheet">
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>

<main class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="fc-card p-4 p-md-5">
                <div class="text-center mb-4">
                    <div class="fc-cookie mb-2"><span>ğŸ¥ </span></div>
                    <div class="fc-form-title">í™˜ì˜í•©ë‹ˆë‹¤!</div>
                    <div class="fc-small text-muted mt-1">1ë¶„ ë§Œì— ì‹œì‘í•´ìš”.</div>
                </div>

                <!-- th:object ì œê±°, ì¼ë°˜ formìœ¼ë¡œ ë³€ê²½ -->
                <form id="signupForm">
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label">ì´ë¦„</label>
                            <input id="name" name="name" class="form-control fc-input" placeholder="í™ê¸¸ë™" required>
                            <div class="invalid-feedback">ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                        </div>
                        <div class="col-12">
                            <label class="form-label">ì´ë©”ì¼</label>
                            <input type="email" id="email" name="email" class="form-control fc-input" placeholder="you@example.com" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" id="password" name="password" class="form-control fc-input" minlength="8" required>
                        </div>
                        <div class="col-12 col-md-6">
                            <label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                            <input type="password" id="passwordConfirm" class="form-control fc-input" minlength="8" required>
                        </div>
                        <div class="col-12">
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="tos" required>
                                <label class="form-check-label fc-small" for="tos">
                                    <a href="/terms">ì´ìš©ì•½ê´€</a> ë° <a href="/privacy">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•©ë‹ˆë‹¤.
                                </label>
                            </div>
                        </div>
                    </div>
                    <button class="w-100 mt-4 fc-btn btn" type="submit">íšŒì›ê°€ì…</button>
                </form>

                <div class="fc-sep my-4"></div>
                <p class="text-center fc-small mb-0">
                    ì´ë¯¸ ê³„ì •ì´ ìˆë‚˜ìš”? <a href="/login"><strong>ë¡œê·¸ì¸</strong></a>
                </p>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById("signupForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const passwordConfirm = document.getElementById("passwordConfirm").value;

        if (password !== passwordConfirm) {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return;
        }

        try {
            const res = await fetch("/api/users/signup", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({name, email, password})
            });

            if (!res.ok) {
                const err = await res.json();
                alert("íšŒì›ê°€ì… ì‹¤íŒ¨: " + (err.message || res.status));
                return;
            }

            const data = await res.json();
            alert("íšŒì›ê°€ì… ì™„ë£Œ! í™˜ì˜í•©ë‹ˆë‹¤, " + data.name + "ë‹˜ ğŸ‰");
            window.location.href = "/login"; // ê°€ì… í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        } catch (err) {
            console.error(err);
            alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    });
</script>
</body>
</html>
