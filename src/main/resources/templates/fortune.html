<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>ì˜¤ëŠ˜ì˜ ì¡°ì–¸ Â· FortuneCookie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/fortune.css" rel="stylesheet">
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>

<main class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="fc-card text-center p-5">
                <div class="fc-cookie mb-3"><span>ğŸ¥ </span></div>
                <h2 id="greeting">ì˜¤ëŠ˜ì˜ ì¡°ì–¸</h2>

                <blockquote id="adviceBox" class="mt-4 fst-italic text-muted">
                    â³ ì˜¤ëŠ˜ì˜ ì¡°ì–¸ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘...
                </blockquote>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/app.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
      const username = sessionStorage.getItem("userName");
      if (!username) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        window.location.href = "/login";
        return;
      }

      document.getElementById("greeting").textContent =
        username + "ë‹˜ì„ ìœ„í•œ ì˜¤ëŠ˜ì˜ ì¡°ì–¸";

      const adviceBox = document.getElementById("adviceBox");

      // âœ… async í•¨ìˆ˜ ì•ˆì—ì„œ await ì‚¬ìš©
      async function loadAdvice() {
        try {
          const res = await fetch("https://api.adviceslip.com/advice?timestamp=" + new Date().getTime());
          const data = await res.json();
          adviceBox.textContent = "ğŸ’¡ " + data.slip.advice;
        } catch (err) {
          console.error(err);
          adviceBox.textContent = "âš ï¸ ì¡°ì–¸ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
        }
      }

      loadAdvice(); // ì‹¤í–‰
    });
</script>

</body>
</html>
