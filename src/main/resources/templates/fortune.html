<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>오늘의 조언 · FortuneCookie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/fortune.css" rel="stylesheet">
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>

<main class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="fc-card text-center p-5">
                <div class="fc-cookie mb-3"><span>🥠</span></div>
                <h2 id="greeting">오늘의 조언</h2>

                <blockquote id="adviceBox" class="mt-4 fst-italic text-muted">
                    ⏳ 오늘의 조언을 가져오는 중...
                </blockquote>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/app.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
      const username = sessionStorage.getItem("userName");
      if (!username) {
        alert("로그인이 필요합니다.");
        window.location.href = "/login";
        return;
      }

      document.getElementById("greeting").textContent =
        username + "님을 위한 오늘의 조언";

      const adviceBox = document.getElementById("adviceBox");

      // ✅ async 함수 안에서 await 사용
      async function loadAdvice() {
        try {
          const res = await fetch("https://api.adviceslip.com/advice?timestamp=" + new Date().getTime());
          const data = await res.json();
          adviceBox.textContent = "💡 " + data.slip.advice;
        } catch (err) {
          console.error(err);
          adviceBox.textContent = "⚠️ 조언을 불러오지 못했습니다. 다시 시도해 주세요.";
        }
      }

      loadAdvice(); // 실행
    });
</script>

</body>
</html>
