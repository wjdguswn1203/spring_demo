<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="utf-8">
    <title>오늘의 포춘쿠키</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/fortune.css}" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,%F0%9F%A5%A0">
    <script src="/js/app.js"></script>
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>

<header class="fc-hero container">
    <span class="badge rounded-pill px-3 py-2 mb-3">오늘의 운세를 가볍게, 재미있게</span>
    <h1 class="fc-title">🥠 오늘의 포춘쿠키</h1>
    <p class="fc-sub mt-2">클릭 한 번으로 랜덤 조언을 받아보세요.<br/>마음에 들면 ‘즐겨찾기’로 저장!</p>

    <div class="d-flex justify-content-center gap-2 mt-4">
        <!-- 로그인한 경우 -->
        <a href="/fortune/today" class="fc-btn btn-lg">오늘의 조언 받기</a>

        <!-- 비로그인인 경우 -->
        <a id="loginBtn" class="fc-btn btn-lg" href="/login" style="display:none;">
            로그인하고 시작하기
        </a>
    </div>
</header>

<main class="container pb-5">
    <!-- 오늘의 결과 카드 (있을 때만 노출) -->
    <section th:if="${fortune != null}" class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
            <div class="fc-card p-4 p-md-5">
                <div class="d-flex align-items-center gap-3">
                    <div class="fc-cookie"><span>🥠</span></div>
                    <div>
                        <h2 class="h4 mb-1">오늘의 조언</h2>
                        <div class="text-muted fc-small" th:text="${#temporals.format(#temporals.createNow(), 'yyyy.MM.dd')}">2025.08.27</div>
                    </div>
                </div>
                <p class="fs-5 mt-4 mb-0" th:text="${fortune?.advice}">Fortune will appear here.</p>

                <div class="d-flex gap-2 mt-4">
                    <form th:action="@{/fortune/favorite}" method="post">
                        <input type="hidden" name="id" th:value="${fortune?.id}">
                        <button class="btn btn-sm fc-btn" type="submit">즐겨찾기</button>
                    </form>
                    <form th:action="@{/fortune/another}" method="post">
                        <button class="btn btn-sm btn-outline-dark" type="submit">하나 더 뽑기</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- 최근 기록/즐겨찾기 미리보기 -->
    <section class="row g-3 mt-5">
        <div class="col-12 col-lg-6">
            <div class="fc-card p-4">
                <div class="d-flex align-items-center justify-content-between">
                    <h3 class="h5 mb-0">최근 기록</h3>
                    <a class="fc-small" th:href="@{/history}">전체 보기 →</a>
                </div>
                <div class="fc-sep my-3"></div>
                <ul class="list-unstyled mb-0">
                    <li class="mb-2" th:each="f : ${recent}">
                        <span class="me-2">•</span><span th:text="${f.advice}">sample</span>
                        <span class="fc-small ms-2 text-muted" th:text="${#temporals.format(f.createdAt, 'MM.dd HH:mm')}">08.27 12:30</span>
                    </li>
                    <li th:if="${#lists.isEmpty(recent)}" class="text-muted fc-small">아직 기록이 없어요.</li>
                </ul>
            </div>
        </div>
        <div class="col-12 col-lg-6">
            <div class="fc-card p-4">
                <div class="d-flex align-items-center justify-content-between">
                    <h3 class="h5 mb-0">즐겨찾기</h3>
                    <a class="fc-small" th:href="@{/favorites}">전체 보기 →</a>
                </div>
                <div class="fc-sep my-3"></div>
                <ul class="list-unstyled mb-0">
                    <li class="mb-2" th:each="f : ${favorites}">
                        <span class="me-2">★</span><span th:text="${f.advice}">favorite sample</span>
                    </li>
                    <li th:if="${#lists.isEmpty(favorites)}" class="text-muted fc-small">즐겨찾기가 비어 있어요.</li>
                </ul>
            </div>
        </div>
    </section>
</main>

<script th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js}"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const username = sessionStorage.getItem("userName"); // 로그인 시 저장해둔 값
        console.log("name: "+username);
        if (username) {
            // 로그인 상태
            document.getElementById("fortuneForm").style.display = "block";
        } else {
            // 비로그인 상태
            document.getElementById("loginBtn").style.display = "block";
        }
    });
</script>
<!-- 플래시 메시지 토스트 -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index:11" th:if="${flash != null}">
    <div class="toast show align-items-center text-bg-light border-0 fc-card p-2">
        <div class="d-flex">
            <div class="toast-body">
                <strong th:text="${flash}">완료되었습니다.</strong>
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>
</body>
</html>
