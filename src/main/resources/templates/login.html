<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>로그인 · FortuneCookie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/fortune.css" rel="stylesheet">
    <script src="/js/app.js"></script>
</head>
<body>
<div th:replace="fragments/navbar :: navbar"></div>

<main class="container py-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-7 col-lg-5">
            <div class="fc-card p-4 p-md-5">
                <div class="text-center mb-4">
                    <div class="fc-cookie mb-2"><span>🥠</span></div>
                    <div class="fc-form-title">다시 오셨네요!</div>
                    <div class="fc-small text-muted mt-1">운세를 보려면 로그인하세요.</div>
                </div>

                <!-- API 호출용 form -->
                <form id="loginForm">
                    <div class="mb-3">
                        <label class="form-label">이메일</label>
                        <input type="email" id="email" class="form-control fc-input" placeholder="you@example.com" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label d-flex justify-content-between">
                            <span>비밀번호</span>
                            <a href="/forgot" class="fc-small">비밀번호 찾기</a>
                        </label>
                        <input type="password" id="password" class="form-control fc-input" required>
                    </div>
                    <button class="w-100 mt-3 fc-btn btn" type="submit">로그인</button>
                </form>

                <div class="fc-sep my-4"></div>
                <p class="text-center fc-small mb-0">
                    아직 계정이 없나요? <a href="/signup"><strong>회원가입</strong></a>
                </p>
            </div>
        </div>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        try {
            const res = await fetch("/api/auth/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, password })
            });

            if (!res.ok) {
                alert("로그인 실패: " + res.status);
                return;
            }

            const data = await res.json();
            alert("로그인 성공! " + data.name + "님 환영합니다 🎉");
            sessionStorage.setItem("userName", data.name);
            // 로그인 성공 후 메인으로 이동
            window.location.href = "/";
        } catch (err) {
            console.error(err);
            alert("서버 오류가 발생했습니다.");
        }
    });
</script>
</body>
</html>
